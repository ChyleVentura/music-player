<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Music Player</title>
</head>
<body>
    <div class="container">
        <div class="music-player">
            <nav>
                <div class="back-btn">
                    <i class="fa-solid fa-chevron-left"></i>
                </div>
                <div class="greet">
                    <p>Hello, Chyle</p>
                </div>
            </nav>
            <div class="player-container">
                <div class="top-container">
                    <div class="title">
                        <h1 class="music-title"></h1>
                        <p class="music-artist"></p>
                    </div>
                    <div class="plus-icon"><i class="fa-solid fa-plus"></i></div>                 
                </div>
                <div class="player-progress">
                    <div id="song-progress">
                    <div class="progressbar" id="progress"></div>
                </div>
                    <div class="time-display">
                        <p class="current-time">0:00</p> 
                        <p class="duration">0:00</p>
                    </div>
                </div>
                <div class="controls">
                        <div><button id="prev" class="fa-solid fa-backward-step"></button></div>
                        <div><button id="backward" class="fa-solid fa-backward"></button></div>
                        <div><button id="playpause" class="fa-solid fa-play"></button></div>
                        <div><button id="forward" class="fa-solid fa-forward"></button></div>
                        <div><button id="next" class="fa-solid fa-forward-step"></button></div>        
                </div>
                <div class="bottom-container">
                    <div><i class="fa-solid fa-headphones"></i></div>
                    <input type="range" value=100 id="volume" min=0 max=100>
                    <div><i class="fa-solid fa-repeat"></i></div>    
            </div>
        </div>
    </div>

    <script>
        const song = new Audio()

        const songs = [
            {
                path:'media/Eminem - Somebody Save Me (feat. Jelly Roll) [Official Music Video].mp3',
                title:'Somebody Save Me',
                artist:'Eminem feat. Jelly Roll',
                img:'url(imgs/1900x1900-000000-80-0-0.jpg)'
            },
            {
                path:'media/Air Supply - All Out Of Love (Lyrics).mp3',
                title:'All Out Of Love',
                artist:'Airsupply',
                img:'url(imgs/airsupply.jpg)'
            },
            {
                path:'media/DAB (Leaked interlude).mp3',
                title:'DAB (Leaked interlude)',
                artist:'HELLMERRY',
                img:'url(imgs/hellmerry.png)'
            }
        ]


        const songProgress = document.getElementById("song-progress")
        const image = document.querySelector('.music-player')
        const progressBar = document.getElementById("progress")
        const control = document.getElementById("playpause")
        const currentSongTime = document.querySelector(".current-time")
        const songDuration = document.querySelector(".duration")
        const forward = document.getElementById("forward")
        const backward = document.getElementById('backward')
        const volume = document.getElementById('volume')
        const prevBtn = document.getElementById('prev')
        const nextBtn = document.getElementById('next')
        const title = document.querySelector('.music-title')
        const artist = document.querySelector('.music-artist')

        let songIndex = 0
        let isPlaying = false

        togglePlay = () =>{
            if(isPlaying){
                pause()
            }else{
                play()
            }
        }

        play =()=>{
            isPlaying = true
            control.classList.replace('fa-play','fa-pause')
            song.play()
        }

        pause =()=>{
            isPlaying = false
            control.classList.replace('fa-pause','fa-play')
            song.pause()
        }

        getSong = (music) =>{
            song.src = music.path
            title.textContent = music.title
            artist.textContent = music.artist
            image.style.backgroundImage = music.img

        }

        song.onloadedmetadata =()=>{
            songProgress.max= song.duration
            songProgress.value = song.currentTime
            let min = "0" + Math.floor(song.duration / 60)
            let sec = "0" + Math.floor(song.duration % 60)

            let dur = min.substr(-2) + ":" + sec.substr(-2)
            songDuration.textContent = dur
        }

        changeMusic = (direction) => {
            
            if(direction === -1 && song.currentTime >= 3){
                song.currentTime = 0
            }else{
                image.classList.add('fadeIn')
                songIndex += direction
                getSong(songs[songIndex])
                play()
                image.addEventListener('animationend', ()=>{ image.classList.remove('fadeIn')})
            }
        }        

        setVolume = () => {
            song.volume = (volume.valueAsNumber/100) 
        }

        adjustTime = (direction) =>{
            song.currentTime = (song.currentTime + direction)
        }

        setProgressBar = (e) =>{
            const width = songProgress.clientWidth;
            const clickX = e.offsetX;
            song.currentTime = (clickX/width) * song.duration
        }

        updateProgressBar = () =>{
            songProgress.max= song.duration
            songProgress.value = song.currentTime
            let min = "0" + Math.floor(song.currentTime / 60)
            let sec = "0" + Math.floor(song.currentTime % 60)

            let dur = min.substr(-2) + ":" + sec.substr(-2)
            currentSongTime.textContent = dur
            progressBar.style.width = ((song.currentTime/song.duration)*100+"%")
        }
        control.addEventListener('click', togglePlay)
        songProgress.addEventListener('click', setProgressBar)
        prevBtn.addEventListener('click', ()=>changeMusic(-1))
        nextBtn.addEventListener('click', ()=>changeMusic(1))
        songProgress.addEventListener('drag', setProgressBar)
        song.addEventListener('timeupdate', updateProgressBar)
        forward.addEventListener('click', ()=> adjustTime(+10))
        backward.addEventListener('click',()=> adjustTime(-10))
        volume.onchange = () =>{setVolume()}

        document.body.onkeyup = (e) =>{
            if(e.keyCode == 32){
                playPause()
            }else if (e.keyCode === 39){
                adjustTime(+10)
            }else if(e.keyCode ===37){
                adjustTime(-10)
            }
        }

        getSong(songs[songIndex])
    </script>
</body>
</html>